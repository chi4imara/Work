# Система сохранения данных PlantSoul

## Обзор

В проект PlantSoul добавлена полноценная система сохранения данных между сессиями приложения. Система использует UserDefaults для простоты и надежности, а также поддерживает резервное копирование и восстановление данных.

## Компоненты системы

### 1. DataManager
Основной класс для управления сохранением и загрузкой данных.

**Основные методы:**
- `savePlants(_:)` - Сохранение растений
- `loadPlants()` - Загрузка растений
- `saveTasks(_:)` - Сохранение задач
- `loadTasks()` - Загрузка задач
- `saveInstructions(_:)` - Сохранение инструкций
- `loadInstructions()` - Загрузка инструкций
- `saveOnboardingStatus(_:)` - Сохранение статуса онбординга
- `loadOnboardingStatus()` - Загрузка статуса онбординга

### 2. DataBackup
Утилиты для создания и восстановления резервных копий.

**Основные методы:**
- `createBackup()` - Создание резервной копии
- `restoreFromBackup(_:)` - Восстановление из резервной копии
- `saveBackupToFile(_:fileName:)` - Сохранение резервной копии в файл
- `loadBackupFromFile(_:)` - Загрузка резервной копии из файла

### 3. Обновленные ViewModels
Все ViewModels теперь автоматически сохраняют и загружают данные:

- **PlantViewModel** - Автоматически сохраняет изменения растений
- **TaskViewModel** - Автоматически сохраняет изменения задач
- **InstructionViewModel** - Автоматически сохраняет изменения инструкций
- **AppViewModel** - Управляет общим состоянием приложения и предоставляет методы для работы с данными

## Как это работает

### Автоматическое сохранение
При каждом изменении данных (добавление, обновление, удаление) ViewModels автоматически вызывают соответствующие методы сохранения через DataManager.

### Загрузка при запуске
При инициализации ViewModels автоматически загружают сохраненные данные. Если данных нет, загружаются тестовые данные.

### Резервное копирование
Система поддерживает создание резервных копий всех данных в JSON формате с возможностью сохранения в файлы и восстановления.

## Использование

### Базовое использование
Система работает автоматически - никаких дополнительных действий не требуется. Все изменения данных сохраняются автоматически.

### Работа с резервными копиями
```swift
if let backup = appViewModel.createBackup() {
    let fileName = "backup_\(Date().timeIntervalSince1970)"
    appViewModel.saveBackupToFile(backup, fileName: fileName)
}

if let backup = appViewModel.loadBackupFromFile(backupURL) {
    appViewModel.restoreFromBackup(backup)
}
```

### Очистка данных (для отладки)
```swift
appViewModel.clearAllData()
```

### Экспорт данных
```swift
if let jsonData = appViewModel.exportData() {
    print(jsonData)
}
```

## Тестирование

Для тестирования системы сохранения данных используйте класс `DataPersistenceDemo`:

```swift
DataPersistenceDemo.runDemo()

let isValid = DataPersistenceDemo.validateDataIntegrity()
```

## Особенности реализации

1. **Codable протокол** - Все модели данных уже реализуют Codable, что упрощает сериализацию
2. **UserDefaults** - Используется для простоты и надежности
3. **Автоматическое сохранение** - Данные сохраняются при каждом изменении
4. **Обработка ошибок** - Все операции сохранения/загрузки обрабатывают ошибки
5. **Резервное копирование** - Поддержка создания и восстановления резервных копий
6. **Валидация данных** - Проверка целостности сохраненных данных

## Безопасность

- Все операции с данными выполняются в главном потоке
- Ошибки логируются в консоль
- Резервные копии содержат метаданные (дата создания, версия приложения)
- Поддержка валидации целостности данных

## Производительность

- Данные сохраняются только при изменениях
- Использование UserDefaults обеспечивает быстрый доступ к данным
- JSON сериализация оптимизирована для небольших объемов данных
- Резервные копии создаются по требованию

## Расширение функциональности

Система легко расширяется для добавления новых типов данных:

1. Добавить новые методы в DataManager
2. Обновить соответствующие ViewModels
3. При необходимости обновить структуры резервного копирования

## Заключение

Система сохранения данных PlantSoul обеспечивает надежное хранение всех данных приложения между сессиями, автоматическое сохранение изменений и возможность резервного копирования. Система проста в использовании и легко расширяется для будущих потребностей приложения.
